{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "RispostaHttpConRapportoEsecuzioneTest",
  "description": "Schema che descrive il corpo di una risposta HTTP per l'endpoint /eseguiTest. Questa risposta include lo status HTTP, un esito complessivo, un messaggio generale e, in caso di problemi, i dettagli .",
  "type": "object",
  "properties": {
    "httpStatus": {
      "description": "Codice di stato HTTP associato a questa risposta.",
      "type": "integer",
      "examples": [200,400,500]
    },
    "successoComplessivo": {
      "description": "Indica l'esito dell'esecuzione del test. True se la compilazione ha successo e tutti i test sono passati, false altrimenti.",
      "type": "boolean"
    },
    "messaggioGenerale": {
      "description": "Messaggio testuale che riassume l'esito complessivo dell'esecuzione.",
      "type": "string",
      "examples": ["TEST PASSATI CON SUCCESSO!", "Errore di Compilazione rilevato.", "Compilazione riuscita, ma alcuni test sono falliti.", "Errore interno del sistema: impossibile procedere con l'esecuzione del test."]
    },
    "erroriCompilazione": {
      "description": "Elenco degli errori di compilazione. Presente e non vuoto se la compilazione è fallita. Assente o vuoto altrimenti.",
      "type": "array",
      "items": {
        "$ref": "#/components/schemas/DettaglioErroreCompilazione"
      }
    },
    "fallimentiTest": {
      "description": "Elenco dei test JUnit falliti. Presente e non vuoto se la compilazione ha avuto successo ma uno o più test sono falliti. Assente o vuoto altrimenti.",
      "type": "array",
      "items": {
        "$ref": "#/components/schemas/DettaglioFallimentoTest"
      }
    }
  },
  "required": [
    "httpStatus",
    "successoComplessivo",
    "messaggioGenerale"
  ],
  "components": {
    "schemas": {
      "DettaglioFallimentoTest": {
        "title": "DettaglioFallimentoTestJUnit",
        "description": "Schema relativo al singolo test fallito",
        "type": "object",
        "properties": {
          "testName": {
            "description": "Nome del test fallito riportato da JUnit Platform Launcher.",
            "type": "string",
            "examples": ["testSommaDueInteri()", "testDifferenzaDueInteri()"]
          },
          "errorMessage": {
            "description": "Messaggio di errore dettagliato e/o l'asserzione fallita trovata da JUnit ",
            "type": "string",
            "examples": [
              "org.opentest4j.AssertionFailedError: expected: <100> but was: <0>",
              "org.opentest4j.AssertionFailedError: expected: <1> but was: <-1>"
            ]
          },
          "errorLine": {
            "description": "Numero di riga sulla quale e' stato trovato l'errore nel codice di test (se disponibile e pertinente).",
            "type": ["integer", "null"],
            "minimum": 1,
            "examples": [42]
          }
        },
        "required": [
          "testName",
          "errorMessage"
        ]
      },
      "DettaglioErroreCompilazione": {
        "title": "DettaglioErroreCompilazione",
        "description": "Schema relativo al singolo errore di compilazione trovato",
        "type": "object",
        "properties": {
          "lineNumber": {
            "description": "Il numero di riga nel codice dove il compilatore ha rilevato l'errore.",
            "type": "integer",
            "format": "int64",
            "minimum": 1,
            "examples": [5, 33]
          },
          "errorMessage": {
            "description": "Messaggio di errore specifico restituito dal compilatore Java relativo alla riga dell'errore",
            "type": "string",
            "examples": [
              "';' expected",
              "reached end of file while parsing",
              "not a statement"
            ]
          },
          "sourceName": {
            "description": "Nome identificativo della classe immessa dal'utente in cui è stato riscontrato l'errore.",
            "type": "string",
            "examples": ["SommaInteriConFunzione"]
          }
        },
        "required": [
          "lineNumber",
          "errorMessage",
          "sourceName"
        ]
      }
    }
  },
  "examples": [
    {
      "comment": "Scenario di successo: Compilazione OK, tutti i test JUnit passati.",
      "value": {
        "httpStatus": 200,
        "successoComplessivo": true,
        "messaggioGenerale": "TEST PASSATI CON SUCCESSO!"
      }
    },
    {
      "comment": "Scenario fallimento test: Compilazione OK, ma uno o più test JUnit falliti.",
      "value": {
        "httpStatus": 400,
        "successoComplessivo": false,
        "messaggioGenerale": "Compilazione riuscita, ma alcuni test sono falliti.",
        "fallimentiTest": [
          {
            "testName": "testSomma1()",
            "errorMessage": "org.opentest4j.AssertionFailedError: expected: <5> but was: <-1>",
            "errorLine": 10
          }
        ]
      }
    },
    {
      "comment": "Scenario errore compilazione: Il codice utente non compila.",
      "value": {
        "httpStatus": 200,
        "successoComplessivo": false,
        "messaggioGenerale": "Errore di Compilazione rilevato.",
        "erroriCompilazione": [
          {
            "lineNumber": 15,
            "errorMessage": "';' expected",
            "sourceName": "UserCode"
          }
        ]
      }
    },
     {
      "comment": "Scenario errore interno di sistema, es. codice di test mancante per la domanda.",
      "value": {
        "httpStatus": 200,
        "successoComplessivo": false,
        "messaggioGenerale": "Errore interno del sistema: impossibile procedere con l'esecuzione del test.",
        "erroreSistema": {
          "messaggio": "Codice di test non disponibile per la domanda ID 'xyz'.",
          "codiceErrore": "TEST_CODE_UNAVAILABLE"
        }
      }
    }
  ]
}